section.panel.content(ng-controller="TradeCtrl")
  .action-window
    ul.info
      li
        span.label Pair =
        span.value XRP/USD
      li
        span.label Bid =
        span.value.up
          | 104.30
          span.icon.up
      li
        span.label Ask =
        span.value 104.26
      li
        span.label Spread =
        span.value.down
          | .04
          span.icon.down
      li
        span.label Last price =
        span.value.down
          | .04
          span.icon.down

    //- 1. Order form

    ng-switch(on="mode")
      form.mode-form(name='orderForm', ng-submit='place_order()', ng-switch-when='trade')
        .currencies
          .currency-field.sell
            label(for='sell_currency') Sell
            input.currency#sell_currency(
              name='sell_currency', type='text'
              rp-combobox="currency_query", rp-combobox-select
              ng-model='order.sell_currency', ng-change='change_pair()')
          .currency-field.buy
            label(for='buy_currency') Buy
            input.currency#buy_currency(
              name='buy_currency', type='text'
              rp-combobox="currency_query", rp-combobox-select
              ng-model='order.buy_currency', ng-change='change_pair()'
              rp-issuer)
            .errorGroup(rp-errors='buy_currency')
              .error(rp-error-on='rpIssuer') You are unable to accept this currency (add trust)
        .order-values
          .value-field
            label(for='order_amount') Amount To Sell
            input#order_amount(
              name='amount', type='number', step='any'
              ng-model='order.sell', ng-change='calc_buy()'
              ng-pattern='/^[0-9.]+$/', required)
            .error(ng-show='orderForm.amount.$error.pattern') Not a valid amount.
            .error(ng-show='orderForm.amount.$error.required && !orderForm.amount.$pristine') Required
          .sign x
          .value-field
            label(for='order_price') Price of Each
            input#order_price(
              name='price', type='number', step='any'
              ng-model='order.price', ng-change='calc_buy()'
              ng-pattern='/^[0-9.]+$/', required)
            .error(ng-show='orderForm.price.$error.pattern') Not a valid price.
            .error(ng-show='orderForm.price.$error.required && !orderForm.price.$pristine') Required
          .sign =
          .value-field
            label(for='order_value') Order Value ({{order.buy_amount | rpcurrency}})
            input#order_value(
              name='value', type='number', step='any'
              ng-model='order.buy', ng-change='calc_sell()'
              ng-pattern='/^[0-9.]+$/', required)
            .error(ng-show='orderForm.value.$error.pattern') Not a valid value.
        .message(ng-show='orderForm.$valid') You are wanting to sell {{order.sell_amount | rpamount}} {{order.sell_amount | rpcurrency}} for {{order.buy_amount | rpamount}} {{order.buy_amount | rpcurrency}} ({{order.price_amount | rpamount}} {{order.sell_amount | rpcurrency}}/{{order.buy_amount | rpcurrency}})
        .submitsection
          button.btn.btn-success.submit(type='submit', ng-disabled='orderForm.$invalid') Place Order

      //- 2. Confirmation

      form.mode-confirm(ng-switch-when='confirm', ng-submit="order_confirmed()")
        p.literal You are about to place an offer selling
          .amount_feedback
            span.value {{order.sell_amount | rpamount}}
            span.currency {{order.sell_amount | rpcurrency}}
          p.literal for
          .dest_feedback
            span.value {{order.buy_amount | rpamount}}
            span.currency {{order.buy_amount | rpcurrency}}
          p.literal Are you sure?
          div
            p.submitsection
              button.btn.back(ng-click='mode="trade"') &laquo; Back
              button.btn.btn-success.submit(type='submit', ng-disabled='confirm_wait') Confirm

      //- 3. Sending

      .mode-sending(ng-switch-when='sending')
        p.throbber.literal Sending offer to Ripple network...

      //- 4. Error

      .mode-error(ng-switch-when='error')
        p.literal Sorry, an error occurred while submitting your transaction. Make sure you are connected to the Internet and try again later.
        p.literal Before trying again, please ensure that the transaction has not been executed already.
        p: button.btn(ng-click='reset()') &laquo; Back

      //- 5. Done

      .mode-done(ng-switch-when='done')
        group.pending(ng-show='tx_result=="pending"')
          h1 Your trade request has been submitted.
        group.result-success(ng-show='tx_result=="cleared"')
          h1 Request has been accepted!
        group.result-error(ng-show='tx_result=="error"')
          h1 Request has been denied!
          p We were unable to submit the request. Please try again later.
        group.result-malformed(ng-show='tx_result=="malformed"')
          h1 Request is malformed!
          p Your request is invalid, reason: {{engine_result}} - {{engine_result_message}}
        group.result-failed(ng-show='tx_result=="failed"')
          h1 Trade failed!
          p(ng-switch on="engine_result")
            span(ng-switch-when="terUNFUNDED") Your account had insufficient balance in specified currency.
            span(ng-switch-default) Trade failed, reason: {{engine_result_message}}
        hr
        div(class="actionLink")
          a(href="#trade", ng-click="reset()") Back to the form

  table.table.table-striped.open-orders
    caption Open Orders
    thead
      tr
        th.pair Pair
        th.price Price
        th.amount Amount
        th.action Action
    tbody
      tr(ng-repeat="entry in offers", class="{{entry.type}}")
        td.pair {{entry.gets | rpcurrency}}/{{entry.pays | rpcurrency}}
        td.price.rpamount {{entry.pays | rpamountratio:entry.gets | rpamount}}
          span.currency {{entry.gets | rpcurrency}}
        td.amount.rpamount {{entry.pays | rpamount}}
          span.currency {{entry.pays | rpcurrency}}
        td.action
          button.btn.btn-danger.btn-small(ng-click='cancel_order()') Cancel
      tr(ng-show="!offers")
        td(colspan="5")
          p.literal You haven't placed any orders.